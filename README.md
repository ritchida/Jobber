# Jobber

Jobber is a Cassandra-backed job reporting service written in Go.

## Development

Jobber uses go-swagger to generate a client and server based on a resource definition file.  The file lives in api/swagger.yml.  To generate the client and server, as well as the Go structs used to serialize/deserialize to/from the REST API, run:

```bash
make generate
```
Successive runs of this command require that the swagger-generated files are removed with:
```bash
make clean
```
The server generated by go-swagger was used as the basis for the Jobber service, whose main function is in cmd/jobber/main.go.  As new APIs are added to the swagger doc and handlers are generated, their initialization must be manually added to the service configuration in cmd/jobber/restapi/configure_jobber.go.  By default, the server listens on 127.0.0.1:9090.  You can configure the host:port that the servier listens on by setting the following environment variable:
```bash
export JOBBER_HOST=<host/ip of jabber server>
export JOBBER_PORT=<port number of jabber server>
```

To run the integration tests you must have an instance of Cassandra running and publicly-accessible.
Once you have an instance/cluster running, set the CASSANDRA_CLUSTER_IPS environment variable:
```bash
export CASSANDRA_CLUSTER_IPS=<ip of cassandra node>
```
Then you can run the Cassandra integration tests:
```bash
go test github.com/ritchida/jobber/pkg/repository
```

To add APIs to the Jobber service, execute the following steps:

* Add any database tables necessary following the conceptual, logical, physical data modelling guidelines for Cassandra
* Modify the the repository in pkg repository jobber_repository.go and pkg/repository/cassandra_jobber.go as necessary to support querying Cassandra
* Add integration tests to pkg/repository/cassandra_jobber_test.go
* Modify the api/swagger.yml file as necessary to support your new API(s)
* make clean
* make generate
* Add an internal representation of your generated API objects in pkg/models, and a mapping between the API and the internal representation
* Add a handler to cmd/jobber/handler to invoke the repository and return data/error to the API as appropriate
* Initialize the service with your handler in cmd/jobber/restapi/configure_jobber.go
* Start the jobber service
* Test your new API!
